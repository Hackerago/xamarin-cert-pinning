using System.Net;
using System.Net.Security;
using System.Security.Cryptography.X509Certificates;

namespace PinCerts
{
	public static class SslValidator
    {
		// TODO: Run the /Utility/Lookup.PublicKeys application to extract the public key for the site's SSL cert
		static string PUBLIC_KEY = "3082020A0282020100C747619AAEF86D077BEED55E66CAF4CD8AE46D760D49AE662EBD5BA6B56868746DD711D1533CA0AE18BD9651ECC1B0961751A5FD8B342F2CB58F06DF8EBB24B11F25067A9FDBB82D2BB60228BB5B6754D15562396C2E1F20CDE9244C2DE0B7F12650BA722CA724306F7DC5220D9BC64B1F6D7B9D081E9BAF22B03CFCE30EBB323724D6128D425F99E4A81FD83881144FB80A947F2383B4EC322764D6D03694A4C9CE05E1EBCD1A7BA2871D8EFB9214A8C15CCEF6FA789354F19BDB96C216442AF9E9A0E7FAD5F9EECF8A173781AB1C10979D1534452E5F5288B15A7BA72FE27A5959570C8D69E245D0CE73204B46A67DEBD13E30C641E9EDE8F5DB75F5D992C70B66B02AAE832CACDD60D575D61F3AAFFDA509FB2E0198DA1CC8C7A071A91816D7A3B16098474B2283701653F33751025A6DD5845AF2CC8A0284493513649DB04C7D79DB1873E90E8B8F75B8D2B249B1DFF1E994B1E7F17D32EB5BAD6C2818050E0A0DA2EE4EDB68D26CCFCFF950FA47334B676E4D6DED98F6B1B7432730BEE9A0ED94078427458270FDE975B65D83A3B6395C788DF80AECD3E4C4FE9D2C4CC44940850283931779FFACF93A9FBAF2223C9D7C4818D44EAA4232AADC4AF7D8B1A5A4FA32C816A0C7959204A74564B115060C15224A6362456A563F30F6AE66172A18CB8E8F68361F368D81A1DCCF6270B3B99DA7B02DA9F07359FAB4652CF4530203010001";
		
        public static void Initialize()
        {
			ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12;
            ServicePointManager.ServerCertificateValidationCallback = OnValidateCertificate;
        }
        
        static bool OnValidateCertificate(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
        {
			var certPublicString = certificate?.GetPublicKeyString();
			return PUBLIC_KEY == certPublicString;
        } 
    }
}